// ==UserScript==
// @name        SSPreviewer (beta)
// @namespace   11powder
// @description 七海で色々なプレビューを表示する
// @include     /^http://www\.sssloxia\.jp/d/.*?(?:\.aspx)(?:\?.+)?$/
// @require     https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.2/require.min.js
// @require     http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js
// @version     0.1.017
// @grant       none
// ==/UserScript==
//
// !!!:第二回更新時に向けてのチェックリスト。現在は暫定的な仕様のため実際の動作と異なる可能性がある
// 日記/メッセージ/台詞の正確なフォーマット
// 改行の変更後の仕様を要確認。
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("lib/ss/profile",["require","exports"],function(e,t){"use strict";var r=function(){function e(t){t?(this.iconURLArray=t.iconURLArray,this.nickname=t.nickname,this.nameColor=t.nameColor):(this.iconURLArray=e.LoadIconURLArray(),this.nickname=e.LoadNickname(),this.nameColor=e.LoadNameColor())}return e.prototype.SaveIconURLArray=function(t){return void 0!==t&&(this.iconURLArray=t),e.SaveIconURLArray(this.iconURLArray),this},e.prototype.SaveNickname=function(t){return void 0!==t&&(this.nickname=t),e.SaveNickname(this.nickname),this},e.prototype.SaveNameColor=function(t){return void 0!==t&&(this.nameColor=t),e.SaveNameColor(this.nickname),this},e.LoadIconURLArray=function(){var e=localStorage.getItem("SSPreview_IconURLArray");return null===e?[]:JSON.parse(e)},e.SaveIconURLArray=function(e){localStorage.setItem("SSPreview_IconURLArray",JSON.stringify(e))},e.LoadNickname=function(){var e=localStorage.getItem("SSPreview_Nickname");return null===e?"(名称)":e},e.SaveNickname=function(e){localStorage.setItem("SSPreview_Nickname",e)},e.LoadNameColor=function(){var e=localStorage.getItem("SSPreview_NameColor");return null===e?"":e},e.SaveNameColor=function(e){localStorage.setItem("SSPreview_NameColor",e)},e}();t.Profile=r}),define("lib/ss/page",["require","exports"],function(e,t){"use strict";var r=function(){function e(e,t){this.profile=e,this.initializer=t}return e.prototype.Init=function(e){this.initializer(e)},Object.defineProperty(e.prototype,"Settings",{get:function(){return this.profile},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Initializer",{get:function(){return this.initializer},enumerable:!0,configurable:!0}),e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("lib/ss/pageConfig",["require","exports"],function(e,t){"use strict";var r=function(){function e(){}return Object.defineProperty(e,"pathnameToPage",{get:function(){return{"/d/mainaction.aspx":e.MainPage,"/d/pbbs.aspx":e.PartyBBS,"/d/tradeaction.aspx":e.Trade,"/d/strgsaction.aspx":e.Reinforcement,"/d/battle.aspx":e.BattleSettings,"/d/battlemessage.aspx":e.BattleWords,"/d/messageaction.aspx":e.Message,"/d/commesaction.aspx":e.GroupMessage,"/d/chara.aspx":e.CharacterSettings,"/d/com.aspx":e.Community}},enumerable:!0,configurable:!0}),e.RunInitializer=function(t,r){this.Common&&this.Common.Init(t);var n=r.pathname;e.pathnameToPage.hasOwnProperty(n)&&e.pathnameToPage[n]&&e.pathnameToPage[n].Init(t)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("lib/util/jquery/customEvent",["require","exports"],function(e,t){"use strict";var r=function(){function e(e,t){var r=this;this.name=e,this.callback=t,this._wrappedCallback=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];r.callback&&r.callback(e,t),$(r).triggerHandler(r.name)}}return Object.defineProperty(e.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),e.prototype.RegisterEvent=function(e,t){e instanceof jQuery?this.evts=[{target:e,eventType:t}]:this.evts=e;for(var r=0,n=this.evts;r<n.length;r++){var i=n[r];$(i.target).on(i.eventType,this._wrappedCallback)}return this},e.prototype.UnregisterEvent=function(e,t){var r=this.evts;if(void 0===e){for(var n=0,i=r;n<i.length;n++){var o=i[n];$(o.target).off(o.eventType,this._wrappedCallback)}return this.evts=[],this}var a;a=e instanceof jQuery?[{target:e,eventType:t}]:e;for(var s=[],u=[],l=r.length-1;l>=0;l--)for(var c=a.length-1;c>=0;c--){var p=r[l],f=a[c];if(f.target.is(p.target)){u.push(p);break}0===c&&s.push(p)}for(var d=0,h=u;d<h.length;d++){var o=h[d];$(o.target).off(o.eventType,this._wrappedCallback)}return this.evts=s,this},e.prototype.Dispose=function(){this.UnregisterEvent()},e}();t.Event=r}),define("lib/util/jquery/replaceTo",["require","exports"],function(e,t){"use strict";function r(e,t){var r=$(t);return $(e).replaceWith(r),r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("lib/util/timer/timer",["require","exports"],function(e,t){"use strict";var r=function(){function e(){this.date_start=0,this.time_ms=0,this.resetTimeWhenStarting=!1}return Object.defineProperty(e.prototype,"Time_ms",{get:function(){return this.time_ms+Date.now()-this.date_start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.date_start},enumerable:!0,configurable:!0}),e.prototype.Start=function(){if(!this.isRunning||this.resetTimeWhenStarting)return this.resetTimeWhenStarting&&this.ResetTime(),this.date_start=Date.now(),this},e.prototype.Stop=function(){return this.Pause().ResetTime()},e.prototype.Pause=function(){if(this.isRunning)return this.time_ms+=Date.now()-this.date_start,this.date_start=0,this},e.prototype.ResetTime=function(){return this.isRunning?this.date_start=Date.now():this.date_start=0,this.time_ms=0,this},e.prototype.PrintTime=function(){return console.log("time(ms): "+this.Time_ms),this},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("lib/util/timer/timerEvent",["require","exports","lib/util/timer/timer"],function(e,t,r){"use strict";var n=function(e){function t(t,r){e.call(this),this.afterPeriod=t,this.period_ms=r,this.id=0}return __extends(t,e),t.prototype.setCallbackArg=function(e){void 0!==e&&(this.callbackArg=e)},t.prototype.Start=function(t){if(this.setCallbackArg(t),!this.isRunning){var r=this.period_ms-this.time_ms;r<0&&(r=0),this.id=setTimeout(this.afterPeriod,r,t)}return e.prototype.Start.call(this),this},t.prototype.Stop=function(e,t){return void 0===e&&(e=!1),e&&(this.setCallbackArg(t),this.afterPeriod(void 0===t?this.callbackArg:t)),this.Pause().ResetTime()},t.prototype.Pause=function(){if(this.isRunning)return clearTimeout(this.id),this.id=0,e.prototype.Pause.call(this),this},t.prototype.ResetTime=function(t){return this.setCallbackArg(t),this.isRunning&&(clearTimeout(this.id),this.id=setTimeout(this.afterPeriod,this.period_ms,void 0===t?this.callbackArg:t)),e.prototype.ResetTime.call(this),this},t}(r.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("lib/preview",["require","exports","lib/util/jquery/customEvent","lib/util/jquery/replaceTo","lib/util/timer/timerEvent"],function(e,t,r,n,i){"use strict";!function(e){e[e.InsertAfter=0]="InsertAfter",e[e.InsertBefore=1]="InsertBefore",e[e.AppendTo=2]="AppendTo",e[e.PrependTo=3]="PrependTo"}(t.InsertionMode||(t.InsertionMode={}));var o=t.InsertionMode,a=function(){function e(t){var n=this;this.isDisabled=!1,this._eventCallback=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return!n.isDisabled&&(n.timerEvt.Start(),!0)},this.onUpdate=new r.Event("updatePreview",this._eventCallback),this.insTarget=t.insTarget,this.insMode=t.insMode,this._delay_ms=t.delay_ms||e._DEFAULT_DELAY_MS,this.timerEvt=new i.default(function(){n.Update()},this._delay_ms),this.timerEvt.resetTimeWhenStarting=!0}return Object.defineProperty(e.prototype,"Delay_ms",{get:function(){return this._delay_ms},set:function(e){this._delay_ms=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsDisabled",{get:function(){return this.isDisabled},enumerable:!0,configurable:!0}),e.prototype.Pause=function(){return this.isDisabled=!0,this},e.prototype.Disable=function(){return this.isDisabled=!0,this.Hide()},e.prototype.Enable=function(){return this.isDisabled=!1,this.Update()},Object.defineProperty(e.prototype,"OnUpdate",{get:function(){return this.onUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"PreviewElement",{get:function(){return this.preview},enumerable:!0,configurable:!0}),e.prototype.InsertPreview=function(e){var t=$(e);switch(this.preview=t[0],this.insMode){case o.InsertAfter:t.insertAfter(this.insTarget);break;case o.InsertBefore:t.insertBefore(this.insTarget);break;case o.AppendTo:t.appendTo(this.insTarget);break;case o.PrependTo:t.prependTo(this.insTarget);break;default:throw new Error("InsertionMode指定エラー")}return this},e.prototype.OverwritePreview=function(e){return this.preview?this.preview=n.default(this.preview,e)[0]:this.InsertPreview(e),this},e.prototype.Show=function(){return this.Update()},e.prototype.Hide=function(){return $(this.preview).hide(),this},e.prototype.Dispose=function(){this.onUpdate.Dispose(),this.Disable().Hide()},e._DEFAULT_DELAY_MS=0,e}();t.Preview=a}),define("lib/util/string/format",["require","exports"],function(e,t){"use strict";function r(e,t){if(null===e||void 0===e)return e;var r=""+e;for(var n in t)void 0===t[n]&&null===t[n]||(r=r.replace(new RegExp("{"+n+"}","g"),""+t[n]));return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("lib/util/string/replaceLoop",["require","exports"],function(e,t){"use strict";function r(e,t,r){if(null===e||void 0===e)return e;var n=""+e;if("string"==typeof t)for(;;){if(n.indexOf(t)===-1)return n;n=n.replace(t,r)}for(;;){if(!t.test(n))return n;n=n.replace(t,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("lib/util/html/escape",["require","exports"],function(e,t){"use strict";function r(e,t,n){return void 0===e||null===e?e:void 0===t||null===t?e.replace(o,function(e){return i[e]}):e.replace(new RegExp(t,n),function(e){return r(e)})}function n(e,t,i){return void 0===e||null===e?e:void 0===t||null===t?e.replace(c,function(e){return a[e]}):e.replace(new RegExp(r(t),i),function(e){return n(e)})}var i={"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"},o=new RegExp("["+Object.keys(i).join("")+"]","g");t.escape=r;for(var a={},s=0,u=Object.keys(i);s<u.length;s++){var l=u[s];a[i[l]]=l}var c=new RegExp("(?:"+Object.keys(a).join("|")+")","g");t.unescape=n}),define("lib/util/html/tag",["require","exports"],function(e,t){"use strict";function r(e){return e.replace(/(?:\r\n|\r|\n)/g,"<BR>")}t.lineBreaksToBR=r}),define("lib/ss/expr/parser",["require","exports"],function(e,t){"use strict";var r=function(){function e(e){this.enableAt3Mode=e.enableAt3Mode,this.iconNumber=e.iconNumber,this.text=e.text,this.changedName=e.hasOwnProperty("changedName")?e.changedName:null}return Object.defineProperty(e.prototype,"EnableAt3Mode",{get:function(){return this.enableAt3Mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Text",{get:function(){return this.text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IconNumber",{get:function(){return this.iconNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ChangedName",{get:function(){return this.changedName},enumerable:!0,configurable:!0}),e}(),n=function(){function e(){}return e.Parse=function(e,t){var n=t?-1:0,i=e.split(/(?:(@@@|@((?![^<@]*\/\d+\/)[^<@]+)@)(?:\/(\d+)\/)?|\/(\d+)\/)/g);if(1===i.length)return[new r({enableAt3Mode:t,iconNumber:n,text:e})];for(var o=[],a=0,s=i.length;a<s;a+=5){var u=i[a];if(0!==a){var l=null,c=t,p=void 0;void 0===i[a-4]?p=i[a-1]:"@@@"===i[a-4]?(p=i[a-2],c=!0):(p=i[a-2],l=i[a-3],c=!1);var f=c?-1:0;void 0!==p&&(f=parseInt(p)),o.push(new r({enableAt3Mode:c,changedName:l,iconNumber:f,text:u}))}else""!==u&&o.push(new r({enableAt3Mode:t,iconNumber:n,text:i[a]}))}return o},e}();t.Parser=n}),define("lib/ss/expr/formatter",["require","exports","lib/util/string/format","lib/util/string/replaceLoop","lib/util/html/escape","lib/util/html/tag","lib/ss/expr/parser"],function(e,t,r,n,i,o,a){"use strict";var s=function(){function e(t){this.profile=t.profile,this.template=t.template||e._DEFAULT_TEMPLATE,this.separator=t.separator||"",this.at3ModeAsDefault=t.at3ModeAsDefault||!1,this.randomizesDiceTag=t.randomizesDiceTag||!1}return Object.defineProperty(e.prototype,"Templates",{get:function(){return this.template},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Separator",{get:function(){return this.separator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Profile",{get:function(){return this.profile},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"At3ModeAsDefault",{get:function(){return this.at3ModeAsDefault},enumerable:!0,configurable:!0}),e.GenerateDiceTag=function(t){void 0===t&&(t=!1);var n=1;return t&&(n=Math.floor(6*Math.random())+1),r.default(e._DEFAULT_DICE_TEMPLATE,{imgDir:e._DEFAULT_IMG_DIR,resultNum:n})},e.prototype.Exec=function(t){var r=this,s=i.escape(t);return s=n.default(s,e.reReplace_EscapedDecoTag,"<span class='$1'>$2</span>"),s=this.Format(a.Parser.Parse(s,this.at3ModeAsDefault)),s=s.replace(e.reReplace_EscapedDiceTag,function(t){return e.GenerateDiceTag(r.randomizesDiceTag)}),s=o.lineBreaksToBR(s),s=i.unescape(s,"<BR>","g")},e.prototype.Format=function(t){var n=this;return t.map(function(t,i,o){var a;a=t.EnableAt3Mode?t.IconNumber===-1?n.template.Body_At3Mode:n.template.Body_At3ModeAndIcon:n.template.Body;var s="";t.IconNumber!==-1&&(s=n.profile.iconURLArray[t.IconNumber]||e._DEFAULT_IMG_DIR+"default.jpg");var u=null===t.ChangedName?n.profile.nickname:t.ChangedName,l=t.Text;return r.default(a,{iconURL:s,name:u,nameColor:n.profile.nameColor,bodyHTML:l})}).join(this.separator)},e._DEFAULT_TEMPLATE={Body:'<table class="WordsTable" CELLSPACING=0 CELLPADDING=0><tr><td class="Icon" rowspan="2"><IMG border = 0 alt=Icon align=left src="{iconURL}" width=60 height=60></td><td class="Name"><font color="{nameColor}" class="B">{name}</font></td></tr><tr><td class="Words">「{bodyHTML}」</td></tr></table>',Body_At3ModeAndIcon:'<table class="WordsTable" CELLSPACING=0 CELLPADDING=0><tr><td class="Icon"><IMG border = 0 alt=Icon align=left src="{iconURL}" width=60 height=60></td><td class="String">{bodyHTML}</td></tr></table>',Body_At3Mode:'<table class="WordsTable" CELLSPACING=0 CELLPADDING=0><tr><td class="Icon"></td><td class="String">{bodyHTML}</td></tr></table>'},e._DEFAULT_DICE_TEMPLATE='<img alt="dice" src="{imgDir}d{resultNum}.png" border="0" height="20" width="20">',e._DEFAULT_IMG_DIR="http://www.sssloxia.jp/p/",e.reReplace_EscapedDecoTag=new RegExp(i.escape("<(F[1-7]|B|I|S)>([\\s\\S]*?)</\\1>"),"g"),e.reReplace_EscapedDiceTag=new RegExp(i.escape("<D>"),"g"),e}();t.Formatter=s}),define("lib/ss/expr/rule",["require","exports"],function(e,t){"use strict";function r(e){var t=e.length-e.replace(/\n/g,"").length,r=e.length-t;return{charCount:r,lfCount:t}}t.CountExprChars=r}),define("lib/ss/preview",["require","exports","lib/util/string/format","lib/preview","lib/ss/expr/formatter","lib/ss/expr/rule"],function(e,t,r,n,i,o){"use strict";t.randomizesDiceTagResult=!1;var a=function(e){function t(r){e.call(this,{insTarget:r.insTarget,insMode:r.insMode,delay_ms:t.DELAY_MS}),this.textbox=r.textbox,this.profile=r.profile,this.formatter=r.formatter,r.hasOwnProperty("template_container")?this.template_container=r.template_container:this.template_container="<div class='preview'>{html}</div>",this.OnUpdate.RegisterEvent($(this.textbox),"keyup")}return __extends(t,e),t.prototype.Update=function(e){var t=this.textbox.value;if(""===t)return this.Hide();var n=e?Object.create(e):{};n.html=this.formatter.Exec(t);var i=r.default(this.template_container,n);return this.OverwritePreview(i),this},t.DELAY_MS=0,t}(n.Preview);t.SSPreview=a;var s=function(e){function r(n){var o=new i.Formatter({profile:n.profile,at3ModeAsDefault:!1,template:r.TEMPLATE,randomizesDiceTag:t.randomizesDiceTagResult});e.call(this,{insTarget:n.insTarget,insMode:n.insMode,textbox:n.textbox,profile:n.profile,formatter:o})}return __extends(r,e),r.TEMPLATE=null,r}(a);t.SerifPreview=s;var u=function(e){function r(n){var o=new i.Formatter({profile:n.profile,at3ModeAsDefault:!1,template:r.TEMPLATE,randomizesDiceTag:t.randomizesDiceTagResult});e.call(this,{insTarget:n.insTarget,insMode:n.insMode,textbox:n.textbox,profile:n.profile,formatter:o})}return __extends(r,e),r.TEMPLATE=null,r}(a);t.MessagePreview=u;var l=function(e){function r(n){var o=new i.Formatter({profile:n.profile,at3ModeAsDefault:!0,template:r.TEMPLATE,randomizesDiceTag:t.randomizesDiceTagResult});e.call(this,{insTarget:n.insTarget,insMode:n.insMode,textbox:n.textbox,profile:n.profile,formatter:o}),this.nameBox=n.nameBox,this.titleBox=n.titleBox,this.OnUpdate.RegisterEvent([{target:$(this.nameBox),eventType:"keyup"},{target:$(this.titleBox),eventType:"keyup"}])}return __extends(r,e),r.prototype.Update=function(){this.template_container=r.TEMPLATE_CONTAINER;var t=this.titleBox.value||"無題",n=this.nameBox.value;return e.prototype.Update.call(this,{title:t,name:n}),this},r.TEMPLATE=null,r.TEMPLATE_CONTAINER="<div class='preview'><div class='BackBoard'><b>xxx ：{title}</b> &nbsp;&nbsp;{name}&#12288;（20xx/xx/xx xx:xx:xx） <br> <br>{html}<br><br><br clear='ALL'></div></div>",r}(a);t.PartyBBSPreview=l;var c=function(e){function n(r){var o=new i.Formatter({profile:r.profile,at3ModeAsDefault:!0,template:n.TEMPLATE,randomizesDiceTag:t.randomizesDiceTagResult});e.call(this,{insTarget:r.insTarget,insMode:r.insMode,textbox:r.textbox,profile:r.profile,formatter:o,template_container:n.TEMPLATE_CONTAINER}),this.countsChars=r.countsChars||!1}return __extends(n,e),n.prototype.UpdateContainer=function(e){return this.countsChars?this.template_container=n.SelectCharCountContainer(e):this.template_container=n.TEMPLATE_CONTAINER,this},n.SelectCharCountContainer=function(e){var t;t=e.charCount>n.MAX_LENGTH_OF_CHARS?"<span name='charCount' class='char_count char_count_over'>{charCount}</span>":"<span name='charCount' class='char_count'>{charCount}</span>";var i;return i=e.lfCount>n.MAX_COUNT_OF_LF?"<span name='lfCount' class='lf_count lf_count_over'>{lfCount}</span>":"<span name='lfCount' class='lf_count'>{lfCount}</span>",r.default(n.TEMPLATE_CONTAINER_COUNTS_CHAR,{charCount:t,lfCount:i})},n.prototype.Update=function(){var t=o.CountExprChars(this.textbox.value);return this.UpdateContainer(t),e.prototype.Update.call(this,t),this},n.TEMPLATE=null,n.TEMPLATE_CONTAINER="<div class='preview'><div class='tablestyle3'>{html}</div></div>",n.TEMPLATE_CONTAINER_COUNTS_CHAR="<div class='preview'><p class='char_count_line'><span class='char_count_cnt'>{charCount} / 5000</span> <span class='lf_count_cnt'>(改行: {lfCount} / 2500)</span></p><div class='tablestyle3'>{html}</div></div>",n.MAX_LENGTH_OF_CHARS=5e3,n.MAX_COUNT_OF_LF=2500,n}(a);t.DiaryPreview=c}),define("lib/ss/pages/characterSettings",["require","exports"],function(e,t){"use strict";var r=function(){function e(){}return e.ExtractIconUrlArray=function(){var e="/p/default.jpg",t=document.getElementById("TextBox7");if(null===t)return[];for(var r=[t.value||e],n=0;;n++){var i=document.getElementById("TextBox"+(n+12));if(null===i)return r;r.push(i.value||e)}},e.ExtractNickname=function(){var e=document.getElementById("TextBox2");return null===e?null:e.value},e}();t.CharacterSettings=r}),define("lib/ss/pages",["require","exports","lib/ss/pages/characterSettings"],function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}n(r)}),define("SSPreviewer.user",["require","exports","lib/ss/profile","lib/ss/pageConfig","lib/ss/page","lib/preview","lib/ss/preview","lib/ss/pages"],function(e,t,r,n,i,o,a,s){"use strict";var u;!function(e){function t(){a.SSPreview.DELAY_MS=100;var e=function(e){$("textarea").each(function(t,r){new a.SerifPreview({insTarget:r,insMode:o.InsertionMode.InsertAfter,textbox:r,profile:e})})},t=function(e){$("textarea").each(function(t,r){var n=$(r).nextUntil("input").last().next()[0];new a.MessagePreview({insTarget:n,insMode:o.InsertionMode.InsertAfter,textbox:r,profile:e})})},u=n.default,l=new r.Profile;u.Common=new i.default(l,function(e){$("#char_Button").before("<center class='F1'>↓(Previewer) アイコン・愛称の自動読込↓</center>")}),$("head").append("<style type='text/css'>\n    .char_count_line {\n        text-align: left;\n    }\n    .char_count_cnt {\n        font-size: 12px;\n    }\n    .lf_count_cnt {\n        font-size: 10px;\n    }\n    .char_count_line .char_count_over, .char_count_line .lf_count_over {\n        color: #CC3333;\n        font-weight: bold;\n    }\n    .char_count_line .char_count_over {\n        font-size: 16px;\n    }\n    .char_count_line .lf_count_over {\n        font-size: 14px;\n    }\n    </style>"),u.MainPage=new i.default(l,function(e){var t=$("#Diary_TextBox")[0],r=(new a.DiaryPreview({insTarget:t,insMode:o.InsertionMode.InsertAfter,textbox:t,profile:e,countsChars:!0}),$("#TextBox12")[0]);new a.SerifPreview({insTarget:r,insMode:o.InsertionMode.InsertAfter,textbox:r,profile:e})}),u.PartyBBS=new i.default(l,function(e){var t=$("#commentTxt");new a.PartyBBSPreview({insTarget:t.closest("div.BackBoard")[0],insMode:o.InsertionMode.InsertAfter,textbox:t[0],profile:e,nameBox:$("#nameTxt")[0],titleBox:$("#titleTxt")[0]})}),u.Trade=new i.default(l,function(t){e(t)}),u.Reinforcement=new i.default(l,function(t){e(t)}),u.BattleSettings=new i.default(l,function(t){e(t)}),u.BattleWords=new i.default(l,function(t){e(t)}),u.Message=new i.default(l,function(e){t(e)}),u.GroupMessage=new i.default(l,function(e){t(e)}),u.CharacterSettings=new i.default(l,function(e){e.SaveIconURLArray(s.CharacterSettings.ExtractIconUrlArray()),e.SaveNickname(s.CharacterSettings.ExtractNickname())}),u.Community=new i.default(l,function(e){var t=$("textarea")[0];new a.DiaryPreview({insTarget:t,insMode:o.InsertionMode.InsertAfter,textbox:t,profile:e})}),u.RunInitializer(l,document.location)}t()}(u||(u={}))}),function(){require(["SSPreviewer.user"],function(){})}();