// ==UserScript==
// @name        SSPreviewer (beta)
// @namespace   11powder
// @author      pejuta
// @description 七海で色々なプレビューを表示する
// @include     /^http://www\.sssloxia\.jp/d/.*?(?:\.aspx)(?:\?.+)?$/
// @require     https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.2/require.min.js
// @require     http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js
// @version     0.1.020
// @grant       none
// ==/UserScript==
//
// !!!:第二回更新時に向けてのチェックリスト。現在は暫定的な仕様のため実際の動作と異なる可能性がある
// 日記/メッセージ/台詞の正確なフォーマット
// 改行の変更後の仕様を要確認。
var __extends=(this&&this.__extends)||function(f,a){for(var e in a){if(a.hasOwnProperty(e)){f[e]=a[e];}}function c(){this.constructor=f;}f.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c());
};define("lib/ss/profile",["require","exports"],function(c,a){var b=(function(){function d(e){if(e){this.iconURLArray=e.iconURLArray;this.nickname=e.nickname;
this.nameColor=e.nameColor;}else{this.iconURLArray=d.LoadIconURLArray();this.nickname=d.LoadNickname();this.nameColor=d.LoadNameColor();}}d.prototype.SaveIconURLArray=function(e){if(e!==undefined){this.iconURLArray=e;
}d.SaveIconURLArray(this.iconURLArray);return this;};d.prototype.SaveNickname=function(e){if(e!==undefined){this.nickname=e;}d.SaveNickname(this.nickname);
return this;};d.prototype.SaveNameColor=function(e){if(e!==undefined){this.nameColor=e;}d.SaveNameColor(this.nickname);return this;};d.LoadIconURLArray=function(){var e=localStorage.getItem("SSPreview_IconURLArray");
if(e===null){return[];}return JSON.parse(e);};d.SaveIconURLArray=function(e){localStorage.setItem("SSPreview_IconURLArray",JSON.stringify(e));};d.LoadNickname=function(){var e=localStorage.getItem("SSPreview_Nickname");
if(e===null){return"(名称)";}return e;};d.SaveNickname=function(e){localStorage.setItem("SSPreview_Nickname",e);};d.LoadNameColor=function(){var e=localStorage.getItem("SSPreview_NameColor");
if(e===null){return"";}return e;};d.SaveNameColor=function(e){localStorage.setItem("SSPreview_NameColor",e);};return d;}());a.Profile=b;});define("lib/ss/page",["require","exports"],function(b,a){var c=(function(){function e(f,g){this.profile=f;
this.initializer=g;}e.prototype.Init=function(f){this.initializer(f);};Object.defineProperty(e.prototype,"Settings",{get:function(){return this.profile;
},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"Initializer",{get:function(){return this.initializer;},enumerable:true,configurable:true});
return e;}());a.Page=c;var d=(function(){function e(){}Object.defineProperty(e,"pathnameToPage",{get:function(){return{"/d/mainaction.aspx":e.MainPage,"/d/pbbs.aspx":e.PartyBBS,"/d/tradeaction.aspx":e.Trade,"/d/strgsaction.aspx":e.Reinforcement,"/d/battle.aspx":e.BattleSettings,"/d/battlemessage.aspx":e.BattleWords,"/d/messageaction.aspx":e.Message,"/d/commesaction.aspx":e.GroupMessage,"/d/chara.aspx":e.CharacterSettings,"/d/com.aspx":e.Community,};
},enumerable:true,configurable:true});e.RunInitializer=function(g,f){if(this.Common){this.Common.Init(g);}var h=f.pathname;if(e.pathnameToPage.hasOwnProperty(h)&&e.pathnameToPage[h]){e.pathnameToPage[h].Init(g);
}};return e;}());a.PageConfig=d;});define("lib/util/string/format",["require","exports"],function(b,a){function c(g,e){if(g===null||g===undefined){return g;
}var f=""+g;for(var d in e){if(e[d]===undefined&&e[d]===null){continue;}f=f.replace(new RegExp("{"+d+"}","g"),""+e[d]);}return f;}return c;});define("lib/util/string/replaceLoop",["require","exports"],function(b,a){function c(f,d,g){if(f===null||f===undefined){return f;
}var e=""+f;if(typeof d==="string"){for(;;){if(e.indexOf(d)===-1){return e;}e=e.replace(d,g);}}for(;;){if(!d.test(e)){return e;}e=e.replace(d,g);}}return c;
});define("lib/util/html/escape",["require","exports"],function(b,e){var g={"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"};var i=new RegExp("["+Object.keys(g).join("")+"]","g");
function l(k,n,m){if(k===undefined||k===null){return k;}if(n===undefined||n===null){return k.replace(i,function(o){return g[o];});}return k.replace(new RegExp(n,m),function(o){return l(o);
});}e.escape=l;var a={};for(var d=0,j=Object.keys(g);d<j.length;d++){var c=j[d];a[g[c]]=c;}var h=new RegExp("(?:"+Object.keys(a).join("|")+")","g");function f(k,n,m){if(k===undefined||k===null){return k;
}if(n===undefined||n===null){return k.replace(h,function(o){return a[o];});}return k.replace(new RegExp(l(n),m),function(o){return f(o);});}e.unescape=f;
});define("lib/util/html/tag",["require","exports"],function(b,a){function c(d){return d.replace(/(?:\r\n|\r|\n)/g,"<BR>");}a.lineBreaksToBR=c;});define("lib/ss/expr/parser",["require","exports"],function(b,a){var c=(function(h){__extends(g,h);
function g(){h.apply(this,arguments);}return g;}(Array));a.IGroupOr=c;var f=(function(g){__extends(h,g);function h(){g.apply(this,arguments);}return h;
}(Array));a.IGroupAnd=f;var d=(function(){function g(h){this.enableAt3Mode=h.enableAt3Mode;this.iconNumber=h.iconNumber;this.text=h.text;this.changedName=h.hasOwnProperty("changedName")?h.changedName:null;
}Object.defineProperty(g.prototype,"EnableAt3Mode",{get:function(){return this.enableAt3Mode;},enumerable:true,configurable:true});Object.defineProperty(g.prototype,"Text",{get:function(){return this.text;
},enumerable:true,configurable:true});Object.defineProperty(g.prototype,"IconNumber",{get:function(){return this.iconNumber;},enumerable:true,configurable:true});
Object.defineProperty(g.prototype,"ChangedName",{get:function(){return this.changedName;},enumerable:true,configurable:true});return g;}());var e=(function(){function g(){}g.Parse=function(i,m,w){var l=m?-1:0;
var x;if(w){x=i.split("###");}else{x=[i];}var n=[];for(var t=0,k=x.length;t<k;t++){var h=x[t].split(/(?:(@@@|@((?![^<@]*\/\d+\/)[^<@]+)@)(?:\/(\d+)\/)?|\/(\d+)\/)/g);
if(h.length===1){n.push([new d({enableAt3Mode:m,iconNumber:l,text:x[t]})]);continue;}var s=[];for(var q=0,o=h.length;q<o;q+=5){var v=h[q];if(q===0){if(v!==""){s.push(new d({enableAt3Mode:m,iconNumber:l,text:h[q]}));
}continue;}var p=null;var u=m;var r=void 0;if(h[q-4]===undefined){r=h[q-1];}else{if(h[q-4]==="@@@"){r=h[q-2];u=true;}else{r=h[q-2];p=h[q-3];u=false;}}var j=u?-1:0;
if(r!==undefined){j=parseInt(r);}s.push(new d({enableAt3Mode:u,changedName:p,iconNumber:j,text:v}));}n.push(s);}return n;};return g;}());a.Parser=e;});
define("lib/preview/model_formatter",["require","exports"],function(b,a){var c=(function(){function d(){}d.prototype.Exec=function(f,e){return f;};return d;
}());a.Formatter=c;});define("lib/ss/preview/config",["require","exports"],function(b,a){a.randomizesDiceTagResult=false;a.previewDelay_ms=0;a.diary_showsCharCounts=true;
});define("lib/ss/preview/model_formatter",["require","exports","lib/util/string/format","lib/util/string/replaceLoop","lib/util/html/escape","lib/util/html/tag","lib/ss/expr/parser","lib/ss/preview/config"],function(b,c,e,f,h,g,d,a){var i=(function(){function j(k){this.profile=k.profile;
this.at3ModeAsDefault=k.at3ModeAsDefault||false;this.allowsOrTag=k.allowsOrTag||false;this.template=k.template||Object.create(j._DEFAULT_TEMPLATE);this.separators=k.separators?{and:k.separators.and||j._DETAULT_SEPARATORS.and,or:k.separators.or||j._DETAULT_SEPARATORS.or}:Object.create(j._DETAULT_SEPARATORS);
}Object.defineProperty(j.prototype,"Profile",{get:function(){return this.profile;},enumerable:true,configurable:true});Object.defineProperty(j.prototype,"Templates",{get:function(){return this.template;
},enumerable:true,configurable:true});Object.defineProperty(j.prototype,"Separators",{get:function(){return this.separators;},enumerable:true,configurable:true});
Object.defineProperty(j.prototype,"At3ModeAsDefault",{get:function(){return this.at3ModeAsDefault;},enumerable:true,configurable:true});Object.defineProperty(j.prototype,"AllowsOrTag",{get:function(){return this.allowsOrTag;
},enumerable:true,configurable:true});j.GenerateDiceTag=function(k){if(k===void 0){k=false;}var l=1;if(k){l=Math.floor(Math.random()*6)+1;}return e(j._DEFAULT_DICE_TEMPLATE,{imgDir:j._DEFAULT_IMG_DIR,resultNum:l});
};j.prototype.Exec=function(l){var k=h.escape(l);k=f(k,j.reReplace_EscapedDecoTag,"<span class='$1'>$2</span>");k=this.Format(d.Parser.Parse(k,this.at3ModeAsDefault,this.allowsOrTag));
k=k.replace(j.reReplace_EscapedDiceTag,function(m){return j.GenerateDiceTag(a.randomizesDiceTagResult);});k=g.lineBreaksToBR(k);k=h.unescape(k,"<BR>","g");
return k;};j.prototype.Format=function(k){var l=this;return k.map(function(o,n,m){return o.map(function(v,q,r){var t;if(v.EnableAt3Mode){if(v.IconNumber===-1){t=l.template.Body_At3Mode;
}else{t=l.template.Body_At3ModeAndIcon;}}else{t=l.template.Body;}var u="";if(v.IconNumber!==-1){u=l.profile.iconURLArray[v.IconNumber]||(j._DEFAULT_IMG_DIR+"default.jpg");
}var s=v.ChangedName===null?l.profile.nickname:v.ChangedName;var p=v.Text;return e(t,{iconURL:u,name:s,nameColor:l.profile.nameColor,bodyHTML:p});}).join(l.separators.and);
}).join(this.separators.or);};j._DEFAULT_TEMPLATE={Body:'<table class="WordsTable" CELLSPACING=0 CELLPADDING=0><tr><td class="Icon" rowspan="2"><IMG border = 0 alt=Icon align=left src="{iconURL}" width=60 height=60></td><td class="Name"><font color="{nameColor}" class="B">{name}</font></td></tr><tr><td class="Words">\u300C{bodyHTML}\u300D</td></tr></table>',Body_At3ModeAndIcon:'<table class="WordsTable" CELLSPACING=0 CELLPADDING=0><tr><td class="Icon"><IMG border = 0 alt=Icon align=left src="{iconURL}" width=60 height=60></td><td class="String">{bodyHTML}</td></tr></table>',Body_At3Mode:'<table class="WordsTable" CELLSPACING=0 CELLPADDING=0><tr><td class="Icon"/><td class="String">{bodyHTML}</td></tr></table>'};
j._DEFAULT_DICE_TEMPLATE='<img alt="dice" src="{imgDir}d{resultNum}.png" border="0" height="20" width="20">';j._DEFAULT_IMG_DIR="http://www.sssloxia.jp/p/";
j._DETAULT_SEPARATORS={and:"",or:"<div class='separator_or'/>"};j.reReplace_EscapedDecoTag=new RegExp(h.escape("<(F[1-7]|B|I|S)>([\\s\\S]*?)</\\1>"),"g");
j.reReplace_EscapedDiceTag=new RegExp(h.escape("<D>"),"g");return j;}());c.Formatter=i;});define("lib/interface/disposable",["require","exports"],function(b,a){});
define("lib/preview/model",["require","exports","lib/preview/model_formatter"],function(c,b,d){var a=(function(){function e(f){if(f===void 0){f=new d.Formatter();
}this.formatter=f;this.source=null;this.previewHTML=null;this.isVisible=false;this.isDisabled=false;}Object.defineProperty(e.prototype,"PreviewHTML",{get:function(){return this.previewHTML;
},enumerable:true,configurable:true});e.prototype.Update=function(g,f){if(this.isDisabled){return false;}if(g===this.source){return false;}this.source=g;
this.previewHTML=this.formatter.Exec(g,f);return true;};Object.defineProperty(e.prototype,"IsVisible",{get:function(){return this.isVisible;},enumerable:true,configurable:true});
e.prototype.SetAsHidden=function(){this.isVisible=false;return this;};e.prototype.SetAsShown=function(){this.isVisible=true;return this;};Object.defineProperty(e.prototype,"IsDisabled",{get:function(){return this.isDisabled;
},enumerable:true,configurable:true});e.prototype.SetAsDisabled=function(){this.isDisabled=true;return this;};e.prototype.SetAsEnabled=function(){this.isDisabled=false;
return this;};e.prototype.Dispose=function(){this.previewHTML=null;this.isDisabled=true;this.isVisible=false;};return e;}());b.PreviewModel=a;});define("lib/ss/preview/partyBBS/model_formatter",["require","exports","lib/util/string/format","lib/ss/preview/model_formatter"],function(c,a,e,b){var d=(function(g){__extends(f,g);
function f(h){g.call(this,h);}f.prototype.Exec=function(k,j){if(j===void 0){j={title:"",name:""};}var h=g.prototype.Exec.call(this,k);if(j.title===""){j=Object.create(j);
j.title="無題";}var i=e(f.TEMPLATE_CONTAINER,j);return e(i,{html:h});};f.TEMPLATE_CONTAINER='<div class="BackBoard">\n    <b>xxx \uFF1A{title}</b> &nbsp;&nbsp;{name}&#12288;\uFF0820xx/xx/xx xx:xx:xx\uFF09 <br> <br>{html}<br><br><br clear="ALL">\n</div>';
return f;}(b.Formatter));a.PartyBBSFormatter=d;});define("lib/ss/preview/partyBBS/model",["require","exports","lib/preview/model","lib/ss/preview/partyBBS/model_formatter"],function(d,c,e,b){var a=(function(g){__extends(f,g);
function f(h){g.call(this,new b.PartyBBSFormatter({profile:h,template:f.TEMPLATE,at3ModeAsDefault:true}));}f.prototype.Update=function(i,h){if(h===void 0){h={title:"",name:""};
}if(this.isDisabled){return false;}if(i===this.source&&h.title===this.title&&h.name===this.name){return false;}this.source=i;this.title=h.title;this.name=h.name;
this.previewHTML=this.formatter.Exec(i,h);return true;};f.TEMPLATE=null;return f;}(e.PreviewModel));c.PartyBBSModel=a;});define("lib/preview/view",["require","exports","jquery"],function(c,b,d){(function(f){f[f.InsertAfter=0]="InsertAfter";
f[f.InsertBefore=1]="InsertBefore";f[f.AppendTo=2]="AppendTo";f[f.PrependTo=3]="PrependTo";})(b.InsertionMode||(b.InsertionMode={}));var e=b.InsertionMode;
var a=(function(){function f(g){this.insertion=g;}Object.defineProperty(f.prototype,"PreviewContainer",{get:function(){return this.$container?this.$container[0]:null;
},enumerable:true,configurable:true});f.prototype.InsertContainer=function(){this.$container=d(f.containerHTML);switch(this.insertion.mode){case e.InsertAfter:this.$container.insertAfter(this.insertion.target);
break;case e.InsertBefore:this.$container.insertBefore(this.insertion.target);break;case e.AppendTo:this.$container.appendTo(this.insertion.target);break;
case e.PrependTo:this.$container.prependTo(this.insertion.target);break;default:throw new Error("InsertionMode指定エラー");}return this;};f.prototype.Hide=function(){if(!this.$container){return;
}this.$container.css("display","none");return this;};f.prototype.Show=function(){if(!this.$container){return;}this.$container.css("display","");return this;
};f.prototype.Update=function(g){if(!this.$container){this.InsertContainer();}if(g.IsVisible){this.Show();}else{this.Hide();}if(g.IsDisabled){return false;
}this.$container.html(g.PreviewHTML);return true;};f.prototype.Dispose=function(){this.$container.remove();};f.containerHTML='<div class="preview"/>';return f;
}());b.PreviewView=a;});define("lib/util/array/set",["require","exports"],function(b,a){var c=(function(){function d(e,f){if(e===void 0){e=function(h,g){return(h===g);
};}this.equalityValidator=e;if(f&&f instanceof Array){this.innerArray=f.concat();}else{this.innerArray=[];}}d.prototype.has=function(f){return this.indexOf(f)!==-1;
};d.prototype.indexOf=function(h){var i=this;var f;var g=this.innerArray.some(function(j,k,e){f=k;return i.equalityValidator(j,h);});if(g){return f;}else{return -1;
}};d.prototype.add=function(f){if(this.has(f)){return this;}this.innerArray.push(f);return this;};d.prototype.del=function(g){var f=this.indexOf(g);if(f===-1){return false;
}this.innerArray.splice(f,1);return true;};d.prototype.clear=function(){this.innerArray=[];};d.prototype.forEach=function(h){for(var g=0,f=this.innerArray;
g<f.length;g++){var e=f[g];h(e,e,this);}};Object.defineProperty(d.prototype,"size",{get:function(){return this.innerArray.length;},enumerable:true,configurable:true});
return d;}());return c;});define("lib/util/jquery/customEvent",["require","exports","lib/util/array/set","jquery"],function(c,b,e,d){function f(h,g){return h.target.is(g)&&h.eventType===g.eventType;
}var a=(function(){function g(h,j){var i=this;this.name=h;this.callback=j;this._wrappedCallback=function(k){if(i.callback){i.callback(k);}d(i).triggerHandler(i.name);
};this.evts=new e(f);}Object.defineProperty(g.prototype,"Name",{get:function(){return this.name;},enumerable:true,configurable:true});g.prototype.RegisterTrigger=function(h){if(this.evts.has(h)){return false;
}d(h.target).on(h.eventType,this._wrappedCallback);this.evts.add(h);return true;};g.prototype.RegisterTriggers=function(i){for(var k=0,j=i;k<j.length;k++){var h=j[k];
this.RegisterTrigger(h);}return this;};g.prototype.UnregisterTrigger=function(h){if(!this.evts.has(h)){return false;}d(h.target).off(h.eventType,this._wrappedCallback);
return this.evts.del(h);};g.prototype.UnregisterTriggers=function(i){if(!i){this.UnregisterAllTriggers();}for(var k=0,j=i;k<j.length;k++){var h=j[k];this.UnregisterTrigger(h);
}return this;};g.prototype.UnregisterAllTriggers=function(){var h=this;this.evts.forEach(function(i){d(i.target).off(i.eventType,h._wrappedCallback);});
this.evts.clear();return this;};g.prototype.Dispose=function(){this.UnregisterAllTriggers();};return g;}());b.Event=a;});define("lib/util/timer/timer",["require","exports"],function(b,a){var c=(function(){function d(){this.date_start=0;
this.time_ms=0;this.resetTimeWhenStarting=false;}Object.defineProperty(d.prototype,"Time_ms",{get:function(){return this.time_ms+Date.now()-this.date_start;
},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"isRunning",{get:function(){return !!this.date_start;},enumerable:true,configurable:true});
d.prototype.Start=function(){if(this.isRunning&&!this.resetTimeWhenStarting){return;}if(this.resetTimeWhenStarting){this.ResetTime();}this.date_start=Date.now();
return this;};d.prototype.Stop=function(){return this.Pause().ResetTime();};d.prototype.Pause=function(){if(!this.isRunning){return;}this.time_ms+=Date.now()-this.date_start;
this.date_start=0;return this;};d.prototype.ResetTime=function(){if(this.isRunning){this.date_start=Date.now();}else{this.date_start=0;}this.time_ms=0;
return this;};d.prototype.PrintTime=function(){console.log("time(ms): "+this.Time_ms);return this;};return d;}());return c;});define("lib/util/timer/timerEvent",["require","exports","lib/util/timer/timer"],function(b,a,c){var d=(function(e){__extends(f,e);
function f(g,h){e.call(this);this.afterPeriod=g;this.period_ms=h;this.id=0;}f.prototype.setCallbackArg=function(g){if(g===undefined){return;}this.callbackArg=g;
};f.prototype.Start=function(h){this.setCallbackArg(h);if(!this.isRunning){var g=this.period_ms-this.time_ms;if(g<0){g=0;}this.id=setTimeout(this.afterPeriod,g,h);
}e.prototype.Start.call(this);return this;};f.prototype.Stop=function(g,h){if(g===void 0){g=false;}if(g){this.setCallbackArg(h);this.afterPeriod((h===undefined?this.callbackArg:h));
}return this.Pause().ResetTime();};f.prototype.Pause=function(){if(!this.isRunning){return;}clearTimeout(this.id);this.id=0;e.prototype.Pause.call(this);
return this;};f.prototype.ResetTime=function(g){this.setCallbackArg(g);if(this.isRunning){clearTimeout(this.id);this.id=setTimeout(this.afterPeriod,this.period_ms,(g===undefined?this.callbackArg:g));
}e.prototype.ResetTime.call(this);return this;};f.prototype.Dispose=function(){this.Stop();};return f;}(c));return d;});define("lib/preview/controller",["require","exports","lib/util/jquery/customEvent","lib/util/timer/timerEvent"],function(b,a,e,d){var c=(function(){function f(g){var h=this;
this.onUpdating=new e.Event("onUpdatingPreview",function(i){h.callback_onUpdating(i);});this.callback_onUpdating=function(i){if(h.model.IsDisabled){return false;
}h.timerEvt.Start();return true;};this.model=g.model;this.view=g.view;this.Delay_ms=g.delay_ms===undefined?f._DEFAULT_DELAY_MS:g.delay_ms;}Object.defineProperty(f.prototype,"OnUpdating",{get:function(){return this.onUpdating;
},enumerable:true,configurable:true});Object.defineProperty(f.prototype,"Delay_ms",{get:function(){return this.delay_ms;},set:function(g){this.delay_ms=g;
this.InitTimerEvent();},enumerable:true,configurable:true});f.prototype.InitTimerEvent=function(){var g=this;if(this.timerEvt){this.timerEvt.Dispose();
}this.timerEvt=new d(function(){g.model.SetAsShown();g.Update();},this.delay_ms);this.timerEvt.resetTimeWhenStarting=true;return this;};f.prototype.Show=function(){this.model.SetAsShown();
return this.Update();};f.prototype.Hide=function(){this.model.SetAsHidden();return this.Update();};f.prototype.Enable=function(){this.model.SetAsEnabled();
return this.Update();};f.prototype.Disable=function(){this.model.SetAsDisabled().SetAsHidden();return this.Update();};f.prototype.Pause=function(){this.model.SetAsDisabled();
return this.Update();};f.prototype.Dispose=function(){this.model.Dispose();this.view.Dispose();this.timerEvt.Dispose();this.onUpdating.Dispose();};f._DEFAULT_DELAY_MS=0;
return f;}());a.PreviewController=c;});define("lib/ss/preview/controller",["require","exports","lib/preview/controller","lib/ss/preview/config"],function(d,b,c,a){var e=(function(g){__extends(f,g);
function f(h){var i=(h.delay_ms===undefined)?a.previewDelay_ms:h.delay_ms;g.call(this,h);this.textbox=h.textbox;this.OnUpdating.RegisterTrigger({target:$(this.textbox),eventType:"keyup"});
}f.prototype.Update=function(h){var i=this.textbox.value;if(i===""){this.model.SetAsHidden();}this.model.Update(i,h);this.view.Update(this.model);return this;
};return f;}(c.PreviewController));b.SSPreviewController=e;});define("lib/ss/preview/partyBBS/controller",["require","exports","lib/ss/preview/partyBBS/model","lib/preview/view","lib/ss/preview/controller"],function(c,b,d,e,a){var f=(function(g){__extends(h,g);
function h(i){var k=new d.PartyBBSModel(i.profile);var j=new e.PreviewView(i.insertion);g.call(this,{delay_ms:i.delay_ms,model:k,view:j,textbox:i.textbox});
this.titleInput=i.titleInput;this.nameInput=i.nameInput;this.OnUpdating.RegisterTriggers([{target:$(this.titleInput),eventType:"keyup"},{target:$(this.nameInput),eventType:"keyup"}]);
}h.prototype.Update=function(){var i=this.nameInput.value;var j=this.titleInput.value;if(i===""){this.model.SetAsHidden();}return g.prototype.Update.call(this,{name:i,title:j});
};return h;}(a.SSPreviewController));b.PartyBBSController=f;});define("lib/ss/preview/diary/model_formatter",["require","exports","lib/util/string/format","lib/ss/preview/model_formatter"],function(c,b,e,a){var d=(function(g){__extends(f,g);
function f(h){g.call(this,h);}f.prototype.Exec=function(i){var h=g.prototype.Exec.call(this,i);return e(f.TEMPLATE_CONTAINER,{html:h});};f.TEMPLATE_CONTAINER='<div name="Diary">{html}</div>';
return f;}(a.Formatter));b.DiaryFormatter=d;});define("lib/ss/expr/rule",["require","exports"],function(c,b){function a(e){var f=e.length-e.replace(/\n/g,"").length;
var d=e.length-f;return{charCount:d,lfCount:f};}b.CountExprChars=a;});define("lib/ss/preview/diary/model",["require","exports","lib/ss/preview/diary/model_formatter","lib/preview/model","lib/ss/expr/rule","lib/ss/preview/config"],function(e,d,b,f,c,a){var g=(function(i){__extends(h,i);
function h(j){i.call(this,new b.DiaryFormatter({profile:j.profile,template:h.TEMPLATE,at3ModeAsDefault:true}));if(typeof j.showsCharCounts==="boolean"){this.showsCharCounts=j.showsCharCounts;
}else{this.showsCharCounts=a.diary_showsCharCounts||false;}}Object.defineProperty(h.prototype,"ShowsCharCounts",{get:function(){return this.showsCharCounts;
},enumerable:true,configurable:true});Object.defineProperty(h.prototype,"CharCounts",{get:function(){return this.charCounts;},enumerable:true,configurable:true});
h.prototype.Update=function(j){this.charCounts=c.CountExprChars(j);return i.prototype.Update.call(this,j);};h.TEMPLATE=null;h.MAX_LENGTH_OF_CHARS=5000;
h.MAX_COUNT_OF_LFS=2500;return h;}(f.PreviewModel));d.DiaryModel=g;});define("lib/ss/preview/diary/view",["require","exports","lib/util/string/format","lib/ss/preview/diary/model","lib/preview/view"],function(c,a,f,b,d){var e=(function(g){__extends(h,g);
function h(i){g.call(this,i);}h.BuildCharCountLine=function(k){var j=h.TEMPLATE_CHARCOUNTS;j=f(j,{charCount:k.charCount,charCountMax:b.DiaryModel.MAX_LENGTH_OF_CHARS,lfCount:k.lfCount,lfCountMax:b.DiaryModel.MAX_COUNT_OF_LFS});
var i=$(j);if(k.charCount>b.DiaryModel.MAX_LENGTH_OF_CHARS){i.children("[name=charCount]").addClass("over");}if(k.lfCount>b.DiaryModel.MAX_COUNT_OF_LFS){i.children("[name=lfCount]").addClass("over");
}return i;};h.prototype.Update=function(i){if(!g.prototype.Update.call(this,i)){return false;}if(i.ShowsCharCounts){this.$container.prepend(h.BuildCharCountLine(i.CharCounts));
}return true;};h.TEMPLATE_CHARCOUNTS='<p class="char_count_line">\n    <span class="char_count_cnt"><span name="charCount" class="char_count">{charCount}</span> / {charCountMax}</span> <span class="lf_count_cnt">(\u6539\u884C: <span name="lfCount" class="lf_count">{lfCount}</span> / {lfCountMax})</span>\n</p>';
return h;}(d.PreviewView));a.DiaryView=e;});define("lib/ss/preview/diary/controller",["require","exports","lib/ss/preview/diary/model","lib/ss/preview/diary/view","lib/ss/preview/controller"],function(d,c,b,e,a){var f=(function(h){__extends(g,h);
function g(i){var k=new b.DiaryModel({profile:i.profile,showsCharCounts:i.showsCharCounts});var j=new e.DiaryView(i.insertion);h.call(this,{delay_ms:i.delay_ms,model:k,view:j,textbox:i.textbox});
}return g;}(a.SSPreviewController));c.DiaryController=f;});define("lib/ss/preview/serif/model",["require","exports","lib/ss/preview/model_formatter","lib/preview/model"],function(c,b,e,a){var d=(function(f){__extends(g,f);
function g(h){f.call(this,new e.Formatter({profile:h,template:g.TEMPLATE,allowsOrTag:true}));}g.TEMPLATE=null;return g;}(a.PreviewModel));b.SerifModel=d;
});define("lib/ss/preview/serif/controller",["require","exports","lib/ss/preview/serif/model","lib/preview/view","lib/ss/preview/controller"],function(e,d,b,f,a){var c=(function(h){__extends(g,h);
function g(i){var k=new b.SerifModel(i.profile);var j=new f.PreviewView(i.insertion);h.call(this,{delay_ms:i.delay_ms,model:k,view:j,textbox:i.textbox});
}return g;}(a.SSPreviewController));d.SerifController=c;});define("lib/ss/preview/message/model",["require","exports","lib/ss/preview/model_formatter","lib/preview/model"],function(b,a,d,e){var c=(function(f){__extends(g,f);
function g(h){f.call(this,new d.Formatter({profile:h,template:g.TEMPLATE}));}g.TEMPLATE=null;return g;}(e.PreviewModel));a.MessageModel=c;});define("lib/ss/preview/message/controller",["require","exports","lib/ss/preview/message/model","lib/preview/view","lib/ss/preview/controller"],function(c,a,e,b,f){var d=(function(g){__extends(h,g);
function h(i){var k=new e.MessageModel(i.profile);var j=new b.PreviewView(i.insertion);g.call(this,{delay_ms:i.delay_ms,model:k,view:j,textbox:i.textbox});
}return h;}(f.SSPreviewController));a.MessageController=d;});define("lib/ss/preview/controllers",["require","exports","lib/ss/preview/partyBBS/controller","lib/ss/preview/diary/controller","lib/ss/preview/serif/controller","lib/ss/preview/message/controller"],function(b,a,f,e,d,c){a.PartyBBS=f.PartyBBSController;
a.Diary=e.DiaryController;a.Serif=d.SerifController;a.Message=c.MessageController;});define("lib/ss/preview/preview",["require","exports","lib/ss/preview/controllers","lib/ss/preview/config","lib/preview/view"],function(d,c,e,a,b){c.Controllers=e;
c.Config=a;c.InsertionMode=b.InsertionMode;});define("lib/ss/pages/characterSettings",["require","exports"],function(c,a){var b=(function(){function d(){}d.ExtractIconUrlArray=function(){var j="/p/default.jpg";
var e=[];for(var g=4;;g+=3){var k=g<10?("0"+g):(""+g);var f=document.getElementsByName("ctl"+k);if(f.length===0){return e;}var h=(f[0]);e.push(h.value||j);
}};d.ExtractNickname=function(){var e=document.getElementById("TextBox2");if(e===null){return null;}return e.value;};return d;}());a.CharacterSettings=b;
});define("lib/ss/pages",["require","exports","lib/ss/pages/characterSettings"],function(b,a,c){a.CharacterSettings=c.CharacterSettings;});define("SSPreviewer.user",["require","exports","jquery","lib/ss/profile","lib/ss/page","lib/ss/preview/preview","lib/ss/pages"],function(c,b,g,d,h,f,e){var a;
(function(i){function j(){f.Config.previewDelay_ms=100;f.Config.randomizesDiceTagResult=true;g("head").append('<style type=\'text/css\'>\n    .clearfix:after {\n        content: "";\n        display: block;\n        clear: both;\n    }\n    .separator_or {\n        background-color: rgba(255,255,255,0.25);\n        border-radius: 2px;\n        margin: 4px 0px;\n        text-align: center;\n        vertical-align: middle;\n    }\n    .separator_or:before {\n        content: "- OR -";\n    }\n</style>');
function k(p){return g("textarea").toArray().map(function(t,s){return new f.Controllers.Serif({profile:p,insertion:{target:t,mode:f.InsertionMode.InsertAfter},textbox:t,});
});}function n(p){return g("textarea").toArray().map(function(t,s){var u=g(t).nextUntil("input").last().next()[0];return new f.Controllers.Message({profile:p,insertion:{target:t,mode:f.InsertionMode.InsertAfter},textbox:t,});
});}function q(t){for(var u=0,s=t;u<s.length;u++){var p=s[u];p.Show();}}function o(s){for(var t=0,p=s;t<p.length;t++){var u=p[t];u.Hide();}}function l(s){g("head").append("<style type='text/css'>\n        .showOnActive, .active .hideOnActive {\n            display: none;\n        }\n        .active .showOnActive, .hideOnActive {\n            display: inherit;\n        }\n    </style>");
var p=g("<a id='showAllPreviews' class='clearFix' href='#' style='display: block; float: right;'><button type='button' onclick='return false;'>全てのプレビューを<span class='hideOnActive'>表示</span><span class='showOnActive'>隠す</span></button></a>").on("click",function(){p.toggleClass("active");
if(p.hasClass("active")){q(s);}else{o(s);}});g("td.BackMessage2").eq(0).prepend(p);}var r=h.PageConfig;var m=new d.Profile();r.Common=new h.Page(m,function(p){g("#char_Button").before("<center class='F1'>↓(Previewer) アイコン・愛称の自動読込↓</center>");
});r.MainPage=new h.Page(m,function(t){g("head").append("<style type='text/css'>\n    .char_count_line {\n        text-align: left;\n    }\n    .char_count_cnt {\n        font-size: 12px;\n    }\n    .lf_count_cnt {\n        font-size: 10px;\n    }\n    .char_count_line .char_count_over, .char_count_line .lf_count_over {\n        color: #CC3333;\n        font-weight: bold;\n    }\n    .char_count_line .char_count_over {\n        font-size: 16px;\n    }\n    .char_count_line .lf_count_over {\n        font-size: 14px;\n    }\n</style>");
var p=g("#Diary_TextBox")[0];var w=new f.Controllers.Diary({profile:t,insertion:{target:p,mode:f.InsertionMode.InsertAfter},textbox:p,});var u=g("#TextBox12")[0];
var v=new f.Controllers.Serif({profile:t,insertion:{target:u,mode:f.InsertionMode.InsertAfter},textbox:u,});var s=g("#TextBox19")[0];var x=new f.Controllers.Serif({profile:t,insertion:{target:s,mode:f.InsertionMode.InsertAfter},textbox:s,});
l([w,v,x]);});r.PartyBBS=new h.Page(m,function(s){var p=g("#commentTxt");var t=new f.Controllers.PartyBBS({profile:s,insertion:{target:p.closest("div.BackBoard")[0],mode:f.InsertionMode.InsertAfter},textbox:p[0],nameInput:g("#nameTxt")[0],titleInput:g("#titleTxt")[0]});
l([t]);});r.Trade=new h.Page(m,function(p){var s=k(p);l(s);});r.Reinforcement=new h.Page(m,function(p){var s=k(p);l(s);});r.BattleSettings=new h.Page(m,function(p){var s=k(p);
l(s);});r.BattleWords=new h.Page(m,function(p){var s=k(p);l(s);});r.Message=new h.Page(m,function(p){var s=n(p);l(s);});r.GroupMessage=new h.Page(m,function(p){var s=n(p);
l(s);});r.CharacterSettings=new h.Page(m,function(p){p.SaveIconURLArray(e.CharacterSettings.ExtractIconUrlArray());p.SaveNickname(e.CharacterSettings.ExtractNickname());
});r.Community=new h.Page(m,function(s){var p=g("textarea")[0];var t=new f.Controllers.Diary({profile:s,insertion:{target:p,mode:f.InsertionMode.InsertAfter},textbox:p,showsCharCounts:false});
l([t]);});r.RunInitializer(m,document.location);}j();})(a||(a={}));});(function(){require(["SSPreviewer.user"],function(){});})();